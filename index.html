<!DOCTYPE html>
<html>
<head>
    <title>üì± X Timeline (Nitter)</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        * { box-sizing:border-box; }
        body { 
            font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; 
            margin:0; padding:0; height:100vh; background:#f7f9fa; overflow:hidden;
        }
        .app { display:flex; height:100vh; }
        .sidebar { 
            width:320px; background:white; box-shadow:2px 0 12px rgba(0,0,0,0.1); overflow-y:auto; 
            border-right:1px solid #e1e8ed;
        }
        .main { flex:1; position:relative; }
        .iframe-container { 
            position:absolute; top:0; left:0; right:0; bottom:0; background:#f7f9fa;
        }
        .iframe { width:100%; height:100%; border:none; background:white; }
        .header { 
            background:#1da1f2; color:white; padding:20px; text-align:center; 
            position:sticky; top:0; z-index:10;
        }
        .handle-item { 
            display:flex; padding:16px 20px; cursor:pointer; border-bottom:1px solid #e1e8ed;
            transition:background 0.2s;
        }
        .handle-item:hover { background:#f7f9fa; }
        
        /* Active state */
        .handle-item.active { 
            background:#1da1f2 !important;
            color:white !important;
        }
        .handle-item.active .handle-link { 
            color:rgba(255,255,255,0.9) !important; 
        }
        
        /* Favorite styling */
        .handle-item.favorite {
            border-left: 4px solid #ffcc00;
            background: linear-gradient(90deg, rgba(255,204,0,0.08) 0%, transparent 20px);
        }
        .handle-item.favorite .handle-name {
            font-weight: 700;
        }
        
        /* Active + Favorite combo */
        .handle-item.active.favorite {
            background: linear-gradient(90deg, #1da1f2 0%, rgba(255,204,0,0.2) 100%) !important;
        }
        .handle-item.active.favorite,
        .handle-item.active.favorite .handle-name,
        .handle-item.active.favorite .handle-link {
            color: #fff !important;
        }
        
        .handle-info { flex:1; }
        .handle-name { font-weight:600; font-size:16px; margin-bottom:4px; }
        .handle-link { color:#657786; font-size:14px; }
        
        /* AVATARS - FIXED & LAST */
        .handle-avatar { 
            width:48px; height:48px; border-radius:50%; 
            display:flex; align-items:center; justify-content:center; 
            font-weight:600; font-size:18px; margin-right:16px;
            color:white;
            background:#1da1f2;  /* ‚úÖ DEFAULT BLUE */
        }
        .handle-item.favorite .handle-avatar {
            background: #ffcc00 !important;
            box-shadow: 0 0 0 2px rgba(255,204,0,0.3);
            color: #333 !important;
        }
        
        .loading { text-align:center; padding:60px 20px; color:#657786; }
        .error { text-align:center; padding:60px 20px; color:#e24; background:#fee; border-radius:12px; margin:20px; }
        @media (max-width: 768px) {
        .app {
            flex-direction: column;
        }
        .sidebar {
            width: 100%;
            height: 40vh;
            border-right: none;
            border-bottom: 1px solid #e1e8ed;
        }
        .main {
            flex: 1;
            height: 60vh;
        }
        }

    </style>


</head>
<body>
    <div class="app">
        <div class="sidebar">
            <div class="header">
                <h2 style="margin:0;font-size:20px;">üì± <a href="https://github.com/tgnoil/x-timeline-viewer/" target="_blank" style="color:white; text-decoration:underline">X Timeline Viewer</a></h2>
                <div id="handle-count" style="font-size:14px;margin-top:4px;opacity:0.9;">Loading...</div>
                

            </div>
            <div id="handles-list" class="loading">Loading handles...</div>
        </div>
        <div class="main">
            <div class="iframe-container">
                <iframe id="nitter-frame" class="iframe" src="about:blank"></iframe>
            </div>
        </div>
    </div>

    <script>
        const NITTER_INSTANCE = 'https://nitter.net';
        let isSorted = false;
        
        async function loadHandles() {
            try {
                const response = await fetch('handles.json');
                const rawData = await response.json();
                
                console.log('Raw JSON:', rawData.slice(0, 3)); // Debug first 3
                
                // SANITIZE: Filter valid accounts only
                let accounts = rawData.filter(item => 
                    item && 
                    typeof item === 'object' && 
                    item.handle && 
                    typeof item.handle === 'string' && 
                    item.handle.length > 0
                ).map(item => ({
                    handle: item.handle,
                    name: item.name || '',
                    favorite: Boolean(item.favorite)
                }));
                
                console.log('Valid accounts:', accounts.length); // Debug
                
                if (accounts.length === 0) {
                    throw new Error('No valid accounts found');
                }
                
                const sidebar = document.getElementById('handles-list');
                const countEl = document.getElementById('handle-count');
                
                countEl.innerHTML = `
                    <span>${accounts.length} accounts ‚Ä¢ via Nitter</span>
                    <button id="sort-btn" style="float:right;background:none;border:1px solid rgba(255,255,255,0.3);color:white;padding:4px 8px;border-radius:4px;font-size:12px;cursor:pointer;">
                        üî§ A-Z
                    </button>
                `;
                
                function renderAccounts(sorted = false) {
                    let displayAccounts = [...accounts];
                    
                    if (sorted) {
                        displayAccounts.sort((a, b) => 
                            (a.name || `@${a.handle}`).localeCompare(b.name || `@${b.handle}`)
                        );
                    } else {
                        displayAccounts.sort((a, b) => Number(b.favorite) - Number(a.favorite));
                    }
                    
                    sidebar.innerHTML = displayAccounts.map(account => {
                        const displayName = account.name || `@${account.handle}`;
                        const avatarChar = (account.name || account.handle).charAt(0).toUpperCase();
                        
                        return `
                            <div class="handle-item ${account.favorite ? 'favorite' : ''}" data-handle="${account.handle}">
                                <div class="handle-avatar">${avatarChar}</div>
                                <div class="handle-info">
                                    <div class="handle-name">${displayName}</div>
                                    <div class="handle-link">@${account.handle} ${account.favorite ? '‚≠ê' : ''}</div>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    document.querySelectorAll('.handle-item').forEach(item => {
                        item.addEventListener('click', function() {
                            document.querySelectorAll('.handle-item').forEach(i => i.classList.remove('active'));
                            this.classList.add('active');
                            document.getElementById('nitter-frame').src = `${NITTER_INSTANCE}/${this.dataset.handle}`;
                        });
                    });
                    
                    const sortBtn = document.getElementById('sort-btn');
                    sortBtn.textContent = sorted ? 'üî§ Original' : 'üî§ A-Z';
                    sortBtn.onclick = () => toggleSort();
                }
                
                function toggleSort() {
                    isSorted = !isSorted;
                    renderAccounts(isSorted);
                }
                
                renderAccounts(false);
                setTimeout(() => document.querySelector('.handle-item')?.click(), 300);
                
            } catch (error) {
                console.error('Full error:', error);
                document.getElementById('handles-list').innerHTML = `
                    <div class="error">
                        <strong>JSON Load Failed</strong><br>
                        <small>F12 Console shows details. Try: echo '[{{"handle":"test"}}]' > handles.json</small>
                    </div>
                `;
            }
        }
        
        document.addEventListener('DOMContentLoaded', loadHandles);
    </script>



<div style="padding:16px 20px; border-top:1px solid #e1e8ed; text-align:center; font-size:12px; color:#657786;">
  <a href="https://github.com/tgnoil/x-timeline-viewer" target="_blank" style="color:#1da1f2; text-decoration:none;">
    ‚≠ê Built with <strong>X Timeline Viewer</strong>
  </a>
  &nbsp;‚Ä¢&nbsp; 
  <a href="https://nitter.net" target="_blank" style="color:#657786;">via Nitter</a>
</div>


</body>
</html>
